C51 COMPILER V9.56.0.0   APP_REPEAT_EXE                                                    07/06/2017 22:09:55 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE APP_REPEAT_EXE
OBJECT MODULE PLACED IN .\Out\Objects\app_repeat_exe.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\App\src\app_repeat_exe.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Com
                    -mon\inc;..\App\inc;..\Bsp\inc;..\Startup;..\Bsp) DEFINE(FOSC_110592) DEBUG OBJECTEXTEND PRINT(.\Out\Listings\app_repeat_
                    -exe.lst) OBJECT(.\Out\Objects\app_repeat_exe.obj)

line level    source

   1          /*
   2           * app_repeat_exe.c
   3           *
   4           *  Created on: 2017年7月6日
   5           *      Author: admin
   6           */
   7          
   8          #include "app.h"
   9          
  10          static REPEAT_T g_tRepeat; /* 定义蜂鸣器全局结构体变量 */
  11          
  12          /*
  13           *********************************************************************************************************
  14           *      函 数 名:
  15           *      功能说明: 初始化
  16           *      形    参：无
  17           *      返 回 值: 无
  18           *********************************************************************************************************
  19           */
  20          void Repeat_Init(void) {
  21   1              Repeat_Stop();
  22   1              g_tRepeat.Start = 0;
  23   1              g_tRepeat.Stop = 0;
  24   1      
  25   1      }
  26          
  27          void Repeat_SetStart(void (*fun)(void)) {
  28   1              g_tRepeat.Start = fun;
  29   1      }
  30          
  31          void Repeat_SetStop(void (*fun)(void)) {
  32   1              g_tRepeat.Stop = fun;
  33   1      }
  34          
  35          void Repeat_Start_exe(void) {
  36   1              if (g_tRepeat.Start != 0) {
  37   2                      g_tRepeat.Start();
  38   2              }
  39   1      }
  40          
  41          void Repeat_Stop_exe(void) {
  42   1              if (g_tRepeat.Stop != 0) {
  43   2                      g_tRepeat.Stop();
  44   2              }
  45   1      }
  46          
  47          /*
  48           *********************************************************************************************************
  49           *      函 数 名:
  50           *      功能说明: 启动。
  51           *      形    参：_usBeepTime : 蜂鸣时间，单位100ms; 0 表示不鸣叫
  52           *                        _usStopTime : 停止时间，单位100ms; 0 表示持续鸣叫
  53           *                       _usCycle : 鸣叫次数， 0 表示持续鸣叫
C51 COMPILER V9.56.0.0   APP_REPEAT_EXE                                                    07/06/2017 22:09:55 PAGE 2   

  54           *      返 回 值: 无
  55           *********************************************************************************************************
  56           */
  57          void Repeat_Start(uint16_t _usStartTime, uint16_t _usStopTime,
  58                          uint16_t _usCycle) {
  59   1              if (_usStartTime == 0) {
  60   2                      return;
  61   2              }
  62   1      
  63   1              g_tRepeat.usStartTime = _usStartTime;
  64   1              g_tRepeat.usStopTime = _usStopTime;
  65   1              g_tRepeat.usCycle = _usCycle;
  66   1              g_tRepeat.usCount = 0;
  67   1              g_tRepeat.usCycleCount = 0;
  68   1              g_tRepeat.ucState = 0;
  69   1              g_tRepeat.ucEnalbe = 1; /* 设置完全局参数后再使能发声标志 */
  70   1      
  71   1              Repeat_Start_exe(); /* 开始发声 */
  72   1      }
  73          
  74          /*
  75           *********************************************************************************************************
  76           *      函 数 名:
  77           *      功能说明: 停止。
  78           *      形    参：无
  79           *      返 回 值: 无
  80           *********************************************************************************************************
  81           */
  82          void Repeat_Stop(void) {
  83   1              g_tRepeat.ucEnalbe = 0;
  84   1      
  85   1              Repeat_Stop_exe(); /* 必须在清控制标志后再停止发声，避免停止后在中断中又开启 */
  86   1      }
  87          
  88          /*
  89           *********************************************************************************************************
  90           *      函 数 名:
  91           *      功能说明: 每隔100ms调用1次该函数，用于控制蜂鸣器发声。该函数在  中被调用。
  92           *      形    参：无
  93           *      返 回 值: 无
  94           *********************************************************************************************************
  95           */
  96          void Repeat_Pro(void) {
  97   1              if ((g_tRepeat.ucEnalbe == 0) || (g_tRepeat.usStopTime == 0)) {
  98   2                      return;
  99   2              }
 100   1      
 101   1              if (g_tRepeat.ucState == 0) {
 102   2                      if (g_tRepeat.usStopTime > 0) /* 间断 */
 103   2                      {
 104   3                              if (++g_tRepeat.usCount >= g_tRepeat.usStartTime) {
 105   4                                      Repeat_Stop_exe(); /* 停止 */
 106   4                                      g_tRepeat.usCount = 0;
 107   4                                      g_tRepeat.ucState = 1;
 108   4                              }
 109   3                      } else {
 110   3                              /* 不做任何处理，连续 */
 111   3                      }
 112   2              } else if (g_tRepeat.ucState == 1) {
 113   2                      if (++g_tRepeat.usCount >= g_tRepeat.usStopTime) {
 114   3                              /* 连续时，直到调用stop停止为止 */
 115   3                              if (g_tRepeat.usCycle > 0) {
C51 COMPILER V9.56.0.0   APP_REPEAT_EXE                                                    07/06/2017 22:09:55 PAGE 3   

 116   4                                      if (++g_tRepeat.usCycleCount >= g_tRepeat.usCycle) {
 117   5                                              /* 循环次数到，停止 */
 118   5                                              g_tRepeat.ucEnalbe = 0;
 119   5                                      }
 120   4      
 121   4                                      if (g_tRepeat.ucEnalbe == 0) {
 122   5                                              g_tRepeat.usStopTime = 0;
 123   5                                              return;
 124   5                                      }
 125   4                              }
 126   3      
 127   3                              g_tRepeat.usCount = 0;
 128   3                              g_tRepeat.ucState = 0;
 129   3      
 130   3                              Repeat_Start_exe(); /* 开始 */
 131   3                      }
 132   2              }
 133   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    317    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     18    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
