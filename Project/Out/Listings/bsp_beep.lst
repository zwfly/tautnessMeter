C51 COMPILER V9.56.0.0   BSP_BEEP                                                          06/27/2017 21:45:45 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE BSP_BEEP
OBJECT MODULE PLACED IN .\Out\Objects\bsp_beep.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Bsp\src\bsp_beep.c LARGE OPTIMIZE(4,SPEED) BROWSE INCDIR(..\Common\in
                    -c;..\App\inc;..\Bsp\inc;..\Startup;..\Bsp) DEFINE(FOSC_110592) DEBUG OBJECTEXTEND PRINT(.\Out\Listings\bsp_beep.lst) OBJ
                    -ECT(.\Out\Objects\bsp_beep.obj)

line level    source

   1          #include "bsp.h"
   2          
   3          #define BEEP_ENABLE()   
   4          #define BEEP_DISABLE()  
   5          
   6          static BEEP_T g_tBeep; /* 定义蜂鸣器全局结构体变量 */
   7          
   8          /*
   9           *********************************************************************************************************
  10           *      函 数 名: BEEP_InitHard
  11           *      功能说明: 初始化蜂鸣器硬件
  12           *      形    参：无
  13           *      返 回 值: 无
  14           *********************************************************************************************************
  15           */
  16          void BEEP_InitHard(void) {
  17   1      
  18   1              P3M1 &= ~SET_BIT0;
  19   1              P3M2 |= SET_BIT0;
  20   1      
  21   1              clr_P30;
  22   1      
  23   1      }
  24          
  25          /*
  26           *********************************************************************************************************
  27           *      函 数 名: BEEP_Start
  28           *      功能说明: 启动蜂鸣音。
  29           *      形    参：_usBeepTime : 蜂鸣时间，单位10ms; 0 表示不鸣叫
  30           *                        _usStopTime : 停止时间，单位10ms; 0 表示持续鸣叫
  31           *                       _usCycle : 鸣叫次数， 0 表示持续鸣叫
  32           *      返 回 值: 无
  33           *********************************************************************************************************
  34           */
  35          void BEEP_Start(uint16_t _usBeepTime, uint16_t _usStopTime, uint16_t _usCycle) {
  36   1              if (_usBeepTime == 0) {
  37   2                      return;
  38   2              }
  39   1      
  40   1              g_tBeep.usBeepTime = _usBeepTime;
  41   1              g_tBeep.usStopTime = _usStopTime;
  42   1              g_tBeep.usCycle = _usCycle;
  43   1              g_tBeep.usCount = 0;
  44   1              g_tBeep.usCycleCount = 0;
  45   1              g_tBeep.ucState = 0;
  46   1              g_tBeep.ucEnalbe = 1; /* 设置完全局参数后再使能发声标志 */
  47   1      
  48   1              BEEP_ENABLE()
  49   1              ; /* 开始发声 */
  50   1      }
  51          
  52          /*
  53           *********************************************************************************************************
C51 COMPILER V9.56.0.0   BSP_BEEP                                                          06/27/2017 21:45:45 PAGE 2   

  54           *      函 数 名: BEEP_Stop
  55           *      功能说明: 停止蜂鸣音。
  56           *      形    参：无
  57           *      返 回 值: 无
  58           *********************************************************************************************************
  59           */
  60          void BEEP_Stop(void) {
  61   1              g_tBeep.ucEnalbe = 0;
  62   1      
  63   1              BEEP_DISABLE()
  64   1              ; /* 必须在清控制标志后再停止发声，避免停止后在中断中又开启 */
  65   1      }
  66          
  67          /*
  68           *********************************************************************************************************
  69           *      函 数 名: BEEP_KeyTone
  70           *      功能说明: 发送按键音
  71           *      形    参：无
  72           *      返 回 值: 无
  73           *********************************************************************************************************
  74           */
  75          void BEEP_KeyTone(void) {
  76   1              BEEP_Start(5, 1, 1); /* 鸣叫50ms，停10ms， 1次 */
  77   1      }
  78          
  79          /*
  80           *********************************************************************************************************
  81           *      函 数 名: BEEP_Pro
  82           *      功能说明: 每隔10ms调用1次该函数，用于控制蜂鸣器发声。该函数在 bsp_timer.c 中被调用。
  83           *      形    参：无
  84           *      返 回 值: 无
  85           *********************************************************************************************************
  86           */
  87          void BEEP_Pro(void) {
  88   1              if ((g_tBeep.ucEnalbe == 0) || (g_tBeep.usStopTime == 0)) {
  89   2                      return;
  90   2              }
  91   1      
  92   1              if (g_tBeep.ucState == 0) {
  93   2                      if (g_tBeep.usStopTime > 0) /* 间断发声 */
  94   2                      {
  95   3                              if (++g_tBeep.usCount >= g_tBeep.usBeepTime) {
  96   4                                      BEEP_DISABLE()
  97   4                                      ; /* 停止发声 */
  98   4                                      g_tBeep.usCount = 0;
  99   4                                      g_tBeep.ucState = 1;
 100   4                              }
 101   3                      } else {
 102   3                              ; /* 不做任何处理，连续发声 */
 103   3                      }
 104   2              } else if (g_tBeep.ucState == 1) {
 105   2                      if (++g_tBeep.usCount >= g_tBeep.usStopTime) {
 106   3                              /* 连续发声时，直到调用stop停止为止 */
 107   3                              if (g_tBeep.usCycle > 0) {
 108   4                                      if (++g_tBeep.usCycleCount >= g_tBeep.usCycle) {
 109   5                                              /* 循环次数到，停止发声 */
 110   5                                              g_tBeep.ucEnalbe = 0;
 111   5                                      }
 112   4      
 113   4                                      if (g_tBeep.ucEnalbe == 0) {
 114   5                                              g_tBeep.usStopTime = 0;
 115   5                                              return;
C51 COMPILER V9.56.0.0   BSP_BEEP                                                          06/27/2017 21:45:45 PAGE 3   

 116   5                                      }
 117   4                              }
 118   3      
 119   3                              g_tBeep.usCount = 0;
 120   3                              g_tBeep.ucState = 0;
 121   3      
 122   3                              BEEP_ENABLE()
 123   3                              ; /* 开始发声 */
 124   3                      }
 125   2              }
 126   1      }
 127          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    263    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     12    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
